<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>jscpd, Copy/Paste Detector</title><link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/themes/prism.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/prism.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/autoloader/prism-autoloader.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/4.1.0/echarts.js" integrity="sha256-5oGDDQdB95LVt6XQcCR1rIRWUIoDC9vtM/TmZFmmvHc=" crossorigin="anonymous"></script><script>Prism.plugins.autoloader.languages_path = 'https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/';
function collapseExpandAll() {
  document.querySelectorAll('.clone').forEach(function(cloneElement) {
    cloneElement.classList.remove('expanded');
  });
  document.querySelector('.clones').classList.toggle('collapsed');
}

function expandCollapse(event) {
  if (event.target.classList.contains('expand') || event.target.classList.contains('collapse')) {
    this.classList.toggle('expanded');
  }

}

window.onload = function() {
  echarts.init(document.getElementById('totalChart')).setOption({
    title: {
      text: 'Copy/paste report',
      x: 'center'
    },
    tooltip: {
      trigger: 'item',
      formatter: "{a} <br/>{b} : {c} lines"
    },
    series: [
      {
        name: 'Copy/Paste report',
        type: 'pie',
        data: [
          { value: 4472, name: 'Total' },
          { value: 123, name: 'Copy/Pasted' },
        ]
      }
    ]
  });

  echarts.init(document.getElementById('formatsChart')).setOption({
    title: {
      text: 'Formats analyzed',
      x: 'center'
    },
    tooltip: {
      trigger: 'item',
      formatter: "{a} <br/>{b} : {c} lines"
    },
    label: {
      normal: {
        show: false,
        position: 'center'
      },
      emphasis: {
        show: true,
        textStyle: {
          fontSize: '30',
          fontWeight: 'bold'
        }
      }
    },
    labelLine: {
      normal: {
        show: false
      }
    },
    series: [
      {
        name: 'Formats analyzed',
        type: 'pie',
        data: [{"value":90,"name":"json"},{"value":4382,"name":"typescript"}]
      }
    ]
  });

  document.querySelectorAll('.clone').forEach(function(cloneElement) {
    cloneElement.addEventListener('click', expandCollapse)
  });
}
</script><style>* {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

a {
  text-decoration: none;
  color: rgb(61, 146, 201);
}

a:hover,
a:focus {
  text-decoration: underline;
}

h3 {
  font-weight: 100;
}

#layout {
  padding: 0;
}

.header {
  text-align: center;
  top: auto;
  margin: 3em auto;
}

.sidebar {
  background: rgb(61, 79, 93);
  color: #fff;
}

.nav-list {
  margin: 0;
  padding: 0;
  list-style: none;
}

.nav-item {
  display: inline-block;
  *display: inline;
  zoom: 1;
}

.nav-item a {
  background: transparent;
  border: 2px solid rgb(176, 202, 219);
  color: #fff;
  margin-top: 1em;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  font-size: 85%;
}

.nav-item a:hover,
.nav-item a:focus {
  border: 2px solid rgb(61, 146, 201);
  text-decoration: none;
}

.content-subhead {
  text-transform: uppercase;
  color: #aaa;
  border-bottom: 1px solid #eee;
  padding: 0.4em 0;
  font-size: 120%;
  font-weight: 500;
  letter-spacing: 0.1em;
}

.content {
  padding: 2em 1em 0;
}

a.top {
  padding-left: 1em;
}

.clone {
  padding-bottom: 2em;

}

.clone header button {
  float: left;
  font-size: 110%;
  margin: 0.1em 0.3em;
}

.clone .expand {
  display: none;
}

.clone .collapse {
  display: block;
}

.collapsed .clone pre {
  display: none;
}

.collapsed .clone .expand {
  display: block;
}

.collapsed .clone .collapse {
  display: none;
}

.clone.expanded .expand {
  display: none !important;
}

.clone.expanded .collapse {
  display: block !important;
}

.clone.expanded pre {
  display: block !important;
}

.clone pre {
  max-width: 1000px;
}

.clone pre .meta {
  font-family: "Courier New", Courier, Monospace;
  display: block;
  float: left;
  line-height: 1.5;
  margin: 0 1em 0 -1em;
  border-right: 0.15em solid #444;
  text-align: right;
}

.clone pre .meta span {
  display: block;
  padding: 0 .5em 0 1em;

}

.clone pre .cl {
  display: block;
  clear: both;
}

.clone-title {
  font-size: 1.1em;
  color: #222;
  margin-bottom: 0.2em;
}

.clone-description {
  font-family: Georgia, "Cambria", serif;
  color: #444;
  line-height: 1.1em;
  font-size: 80%;
}

.controls {
  text-align: right;
}

.controls button {
  font-size: 70%;
}

.mode-stats {
  color: #999;
  font-size: 90%;
  margin: 0;
}

.mode-rate {
  margin: 0 0.1em;
  padding: 0.3em 1em;
  color: #fff;
  background: #999;
  font-size: 80%;
}

.stats {
  width: 100%;
  margin: 1em 0;
}

.clones-excellent {
  background: #5aba59;
}

.clones-fine {
  background: #4d85d1;
}

.clones-danger {
  background: #df2d4f;
}

.footer {
  padding: 1em 0;
  color: #999;
  font-size: 70%;
}

@media (min-width: 48em) {
  .content {
    padding: 2em 3em 0;
    margin-left: 25%;
  }

  .header {
    text-align: right;
  }

  .sidebar {
    position: fixed;
    top: 0;
    width: 25%;
    bottom: 0;
    padding: 1em;
  }

  .footer {
    text-align: center;

  }
}</style></head><body><div class="pure-g" id="layout"><div class="sidebar pure-u-1 pure-u-md-1-4"><div class="header"><img src="https://raw.githubusercontent.com/kucherenko/jscpd/1.0.0-alpha/assets/logo-small-box.svg?sanitize=true" width="190"><nav class="nav"><ul class="nav-list"><li class="nav-item"><a class="pure-button" href="#json">json</a></li><li class="nav-item"><a class="pure-button" href="#typescript">typescript</a></li></ul></nav></div></div><div class="content pure-u-1 pure-u-md-3-4"><a name="top"></a><div class="pure-g"><div class="pure-u-1-2 pure-u-md-1" id="totalChart" style="min-height:20em;"></div><div class="pure-u-1-2 pure-u-md-1" id="formatsChart" style="min-height:20em;"></div></div><div class="controls"><div class="pure-u"><button class="pure-button" onclick="collapseExpandAll()">Collapse/Expand All</button></div></div><table class="pure-table stats"><thead><tr><th>Total files</th><th>Total lines of code</th><th>Duplicated lines</th><th>% of duplications</th></tr></thead><tbody><tr><td>91</td><td>4472</td><td>123</td><td>2.75%</td></tr></tbody></table><div class="clones collapsed"><a name="json"></a><h1 class="content-subhead">json</h1><div class="mode-stats"><p><span class="mode-rate">0%</span> Total files: 2, total lines of code: 90, duplicated lines: 0<a class="top" href="#top">[Top ↑↑↑]</a></p></div><a name="typescript"></a><h1 class="content-subhead">typescript</h1><div class="mode-stats"><p><span class="mode-rate">2.81%</span> Total files: 89, total lines of code: 4382, duplicated lines: 123<a class="top" href="#top">[Top ↑↑↑]</a></p></div><section class="clone"><header><button class="pure-button expand">+</button><button class="pure-button collapse">-</button><div class="clone-title">src\handlers\movies-requesting.handlers.ts[93:27 - 105:13]<br/>src\handlers\movies-requesting.handlers.ts[81:40 - 92:11]</div></header><div class="clone-description"><pre><span class="meta"><span>93</span><span>94</span><span>95</span><span>96</span><span>97</span><span>98</span><span>99</span><span>100</span><span>101</span><span>102</span><span>103</span><span>104</span><span>105</span></span><span class="meta"><span>81</span><span>82</span><span>83</span><span>84</span><span>85</span><span>86</span><span>87</span><span>88</span><span>89</span><span>90</span><span>91</span><span>92</span><span>93</span></span><code class="language-typescript">.map&lt;MovieRequestThin&gt;(
          mo =&gt;
            ({
              ttid: mo.ttid,
              poster: mo.image.url,
              rate: 0,
              _id: null,
              title: mo.title,
              year: mo.year,
            } as any),
        );

      return</code><span class="cl"></span></pre></div></section><section class="clone"><header><button class="pure-button expand">+</button><button class="pure-button collapse">-</button><div class="clone-title">src\handlers\movies-requesting.handlers.ts[134:7 - 147:22]<br/>src\handlers\movies-requesting.handlers.ts[45:9 - 58:28]</div></header><div class="clone-description"><pre><span class="meta"><span>134</span><span>135</span><span>136</span><span>137</span><span>138</span><span>139</span><span>140</span><span>141</span><span>142</span><span>143</span><span>144</span><span>145</span><span>146</span><span>147</span></span><span class="meta"><span>45</span><span>46</span><span>47</span><span>48</span><span>49</span><span>50</span><span>51</span><span>52</span><span>53</span><span>54</span><span>55</span><span>56</span><span>57</span><span>58</span></span><code class="language-typescript">await CacheServices.publishToDigest({ url: req.originalUrl, data: chunk.fullDocument });
      res.write(convertToBuffer(chunk.fullDocument));
    });

    req.on('close', async () =&gt; {
      await CacheServices.clearSubscription(hashedUrl);
      streamingChange.close();
    });
  } else {
    function listenerFn(data: any) {
      res.write(convertToBuffer(data));
    }

    req.on('close', (</code><span class="cl"></span></pre></div></section><section class="clone"><header><button class="pure-button expand">+</button><button class="pure-button collapse">-</button><div class="clone-title">__tests__\services\listing.test.ts[26:52 - 35:33]<br/>__tests__\services\authorizing.test.ts[30:56 - 36:32]</div></header><div class="clone-description"><pre><span class="meta"><span>26</span><span>27</span><span>28</span><span>29</span><span>30</span><span>31</span><span>32</span><span>33</span><span>34</span><span>35</span></span><span class="meta"><span>30</span><span>31</span><span>32</span><span>33</span><span>34</span><span>35</span><span>36</span><span>37</span><span>38</span><span>39</span></span><code class="language-typescript">);
    connection = connect.connection;

    await database.collection('users').insertMany(usersFixture);
    await database.collection('users').createIndex({email: 1}, {unique: true});
    await database.collection('users').createIndex({username: 1}, {unique: true});

    await database.collection('movies').insertMany(moviesFixture);

    repository = ListsRepository</code><span class="cl"></span></pre></div></section><section class="clone"><header><button class="pure-button expand">+</button><button class="pure-button collapse">-</button><div class="clone-title">__tests__\services\movies-requesting.test.ts[24:51 - 32:10]<br/>__tests__\services\authorizing.test.ts[30:56 - 36:15]</div></header><div class="clone-description"><pre><span class="meta"><span>24</span><span>25</span><span>26</span><span>27</span><span>28</span><span>29</span><span>30</span><span>31</span><span>32</span></span><span class="meta"><span>30</span><span>31</span><span>32</span><span>33</span><span>34</span><span>35</span><span>36</span><span>37</span><span>38</span></span><code class="language-typescript">);
    connection = connect.connection;

    await database.collection('users').insertMany(usersFixture);
    await database.collection('users').createIndex({email: 1}, {unique: true});
    await database.collection('users').createIndex({username: 1}, {unique: true});

    await database.collection('movies').insertMany(moviesFixture);
    await</code><span class="cl"></span></pre></div></section><section class="clone"><header><button class="pure-button expand">+</button><button class="pure-button collapse">-</button><div class="clone-title">__tests__\services\user-controling.test.ts[75:49 - 85:33]<br/>__tests__\services\user-controling.test.ts[60:49 - 70:61]</div></header><div class="clone-description"><pre><span class="meta"><span>75</span><span>76</span><span>77</span><span>78</span><span>79</span><span>80</span><span>81</span><span>82</span><span>83</span><span>84</span><span>85</span></span><span class="meta"><span>60</span><span>61</span><span>62</span><span>63</span><span>64</span><span>65</span><span>66</span><span>67</span><span>68</span><span>69</span><span>70</span></span><code class="language-typescript">);
    }

    try {
      await services.get({username: testGuyObject.username, selfId: usersFixture[0]._id});
    } catch (e) {
      expect(e).toBeInstanceOf(UserNotFoundError);
    }
  });

  it('searches for users / repo'</code><span class="cl"></span></pre></div></section><section class="clone"><header><button class="pure-button expand">+</button><button class="pure-button collapse">-</button><div class="clone-title">__tests__\services\user-controling.test.ts[1:1 - 10:32]<br/>__tests__\services\listing.test.ts[1:1 - 10:24]</div></header><div class="clone-description"><pre><span class="meta"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span></span><span class="meta"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span></span><code class="language-typescript">import {Db, MongoClient, ObjectId} from 'mongodb';

import {connectToDatabase} from '../../src/database';
import {usersFixture} from '../fixtures/users.fixture';
import {moviesFixture} from '../fixtures/movies.fixture';
import {UserNotFoundError} from '../../src/errors/domain-errors/user-not-found';
import {InvalidEmailError} from '../../src/errors/application-errors/invalid-email';
import {UserRegisterError} from '../../src/errors/domain-errors/user-register';
// Service &amp; Repo
import {UserControllingServices</code><span class="cl"></span></pre></div></section><section class="clone"><header><button class="pure-button expand">+</button><button class="pure-button collapse">-</button><div class="clone-title">__tests__\services\user-controling.test.ts[26:50 - 35:33]<br/>__tests__\services\authorizing.test.ts[30:56 - 36:32]</div></header><div class="clone-description"><pre><span class="meta"><span>26</span><span>27</span><span>28</span><span>29</span><span>30</span><span>31</span><span>32</span><span>33</span><span>34</span><span>35</span></span><span class="meta"><span>30</span><span>31</span><span>32</span><span>33</span><span>34</span><span>35</span><span>36</span><span>37</span><span>38</span><span>39</span></span><code class="language-typescript">);
    connection = connect.connection;

    await database.collection('users').insertMany(usersFixture);
    await database.collection('users').createIndex({email: 1}, {unique: true});
    await database.collection('users').createIndex({username: 1}, {unique: true});

    await database.collection('movies').insertMany(moviesFixture);

    repository = UsersRepository</code><span class="cl"></span></pre></div></section><section class="clone"><header><button class="pure-button expand">+</button><button class="pure-button collapse">-</button><div class="clone-title">src\pkg\storage\mongo\lists.repository.ts[153:63 - 177:16]<br/>src\pkg\storage\mongo\lists.repository.ts[64:20 - 88:14]</div></header><div class="clone-description"><pre><span class="meta"><span>153</span><span>154</span><span>155</span><span>156</span><span>157</span><span>158</span><span>159</span><span>160</span><span>161</span><span>162</span><span>163</span><span>164</span><span>165</span><span>166</span><span>167</span><span>168</span><span>169</span><span>170</span><span>171</span><span>172</span><span>173</span><span>174</span><span>175</span><span>176</span><span>177</span></span><span class="meta"><span>64</span><span>65</span><span>66</span><span>67</span><span>68</span><span>69</span><span>70</span><span>71</span><span>72</span><span>73</span><span>74</span><span>75</span><span>76</span><span>77</span><span>78</span><span>79</span><span>80</span><span>81</span><span>82</span><span>83</span><span>84</span><span>85</span><span>86</span><span>87</span><span>88</span></span><code class="language-typescript">,
                },
              },
              {
                // filter the movies rated only by that user
                $addFields: {
                  ratedBy: {
                    $filter: {
                      input: '$ratedBy',
                      as: 'rate',
                      cond: {$eq: ['$$rate.userId', '$$userId']},
                    },
                  },
                },
              },
              {$unwind: '$ratedBy'},
              {
                $project: {
                  _id: '$_id',
                  title: '$title',
                  poster: '$poster',
                  rate: '$ratedBy.rate',
                },
              },
              {</code><span class="cl"></span></pre></div></section><section class="clone"><header><button class="pure-button expand">+</button><button class="pure-button collapse">-</button><div class="clone-title">src\pkg\storage\mongo\users.repository.ts[320:13 - 328:20]<br/>src\pkg\storage\mongo\users.repository.ts[290:11 - 298:24]</div></header><div class="clone-description"><pre><span class="meta"><span>320</span><span>321</span><span>322</span><span>323</span><span>324</span><span>325</span><span>326</span><span>327</span><span>328</span></span><span class="meta"><span>290</span><span>291</span><span>292</span><span>293</span><span>294</span><span>295</span><span>296</span><span>297</span><span>298</span></span><code class="language-typescript">: async ({userId, followId}: {userId: ObjectId; followId: ObjectId}) =&gt; {
      const followed = await connection.collection&lt;User&gt;('users').bulkWrite([
        {
          updateOne: {
            filter: {
              _id: userId,
            },
            update: {
              $pull</code><span class="cl"></span></pre></div></section><section class="clone"><header><button class="pure-button expand">+</button><button class="pure-button collapse">-</button><div class="clone-title">src\pkg\storage\mongo\users.repository.ts[227:47 - 248:11]<br/>src\pkg\storage\mongo\lists.repository.ts[166:17 - 187:11]</div></header><div class="clone-description"><pre><span class="meta"><span>227</span><span>228</span><span>229</span><span>230</span><span>231</span><span>232</span><span>233</span><span>234</span><span>235</span><span>236</span><span>237</span><span>238</span><span>239</span><span>240</span><span>241</span><span>242</span><span>243</span><span>244</span><span>245</span><span>246</span><span>247</span><span>248</span></span><span class="meta"><span>166</span><span>167</span><span>168</span><span>169</span><span>170</span><span>171</span><span>172</span><span>173</span><span>174</span><span>175</span><span>176</span><span>177</span><span>178</span><span>179</span><span>180</span><span>181</span><span>182</span><span>183</span><span>184</span><span>185</span><span>186</span><span>187</span></span><code class="language-typescript">},
              },
              {$unwind: '$ratedBy'},
              {
                $project: {
                  _id: '$_id',
                  title: '$title',
                  poster: '$poster',
                  rate: '$ratedBy.rate',
                },
              },
              {
                $group: {
                  _id: '$_id',
                  title: {$first: '$title'},
                  poster: {$first: '$poster'},
                  rate: {$first: '$rate'},
                },
              },
            ],
          },
        })</code><span class="cl"></span></pre></div></section></div><div class="footer"><p>© 2013-2018 jscpd, copy/paste detector</p></div></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-730549-17"></script><script>window.dataLayer = window.dataLayer || [];
function gtag() {
  dataLayer.push(arguments);
}
gtag('js', new Date());
gtag('config', 'UA-730549-17');</script></body></html>